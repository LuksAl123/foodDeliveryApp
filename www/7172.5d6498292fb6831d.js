"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7172],{3033:(O,f,a)=>{a.d(f,{k:()=>i});class i{constructor(h,g,u,A,y,E,c,D){this.uid=h,this.title=g,this.address=u,this.landmark=A,this.house=y,this.lat=E,this.lng=c,this.id=D}}},7172:(O,f,a)=>{a.d(f,{D:()=>E});var i=a(5861),v=a(1135),h=a(3900),g=a(3033),u=a(2223),A=a(1228),y=a(2158);let E=(()=>{class c{get addresses(){return this._addresses.asObservable()}get addressChange(){return this._addressChange.asObservable()}constructor(s,e){this.authService=s,this.api=e,this._addresses=new v.X([]),this._addressChange=new v.X(null)}getUid(){var s=this;return(0,i.Z)(function*(){return yield s.authService.getId()})()}getAddressRef(s){var e=this;return(0,i.Z)(function*(){return e.uid||(e.uid=yield e.getUid()),yield e.api.collection("address").doc(e.uid).collection("all",s)})()}getAddresses(s){var e=this;return(0,i.Z)(function*(){try{let t;t=s?yield e.getAddressRef(r=>r.limit(s)):yield e.getAddressRef();const d=yield t.get().pipe((0,h.w)(function(){var r=(0,i.Z)(function*(n){let l=yield n.docs.map(o=>{let _=o.data();return _.id=o.id,_});return console.log(l),l});return function(n){return r.apply(this,arguments)}}())).toPromise();return console.log("allAddress: ",d),e._addresses.next(d),d}catch(t){throw console.log(t),t}})()}addAddress(s){var e=this;return(0,i.Z)(function*(){try{const t=e._addresses.value,d=new g.k(e.uid?e.uid:yield e.getUid(),s.title,s.address,s.landmark,s.house,s.lat,s.lng);let r=Object.assign({},d);delete r.id;const n=yield(yield e.getAddressRef()).add(r);console.log("response: ",n);const l=yield n.id,o={...r,id:l};return t.push(o),e._addresses.next(t),e._addressChange.next(o),o}catch(t){throw t}})()}updateAddress(s,e){var t=this;return(0,i.Z)(function*(){try{yield(yield t.getAddressRef()).doc(s).update(e);let d=t._addresses.value;const r=d.findIndex(l=>l.id==s),n=new g.k(e.user_id,e.title,e.address,e.landmark,e.house,e.lat,e.lng,s);return d[r]=n,t._addresses.next(d),t._addressChange.next(n),n}catch(d){throw d}})()}deleteAddress(s){var e=this;return(0,i.Z)(function*(){try{yield(yield e.getAddressRef()).doc(s.id).delete();let t=e._addresses.value;return t=t.filter(d=>d.id!=s.id),e._addresses.next(t),t}catch(t){throw t}})()}changeAddress(s){this._addressChange.next(s)}checkExistAddress(s){var e=this;return(0,i.Z)(function*(){try{console.log("check exist address: ",s);let t=s;const d=yield(yield e.getAddressRef(r=>r.where("lat","==",s.lat).where("lng","==",s.lng))).get().pipe((0,h.w)(function(){var r=(0,i.Z)(function*(n){let l=yield n.docs.map(o=>{let _=o.data();return _.id=o.id,_});return console.log(l),l});return function(n){return r.apply(this,arguments)}}())).toPromise();return console.log("addresses: ",d),d?.length>0&&(t=d[0]),console.log("loc: ",t),e.changeAddress(t),t}catch(t){throw t}})()}}return c.\u0275fac=function(s){return new(s||c)(u.LFG(A.e),u.LFG(y.s))},c.\u0275prov=u.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()}}]);