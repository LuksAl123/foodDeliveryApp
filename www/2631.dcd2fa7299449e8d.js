"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2631],{2631:(I,T,a)=>{a.r(T),a.d(T,{AccountPageModule:()=>k});var g=a(4755),f=a(5030),i=a(6794),P=a(4517),p=a(5861),e=a(2223),O=a(1135),S=a(4872),m=a(1228),A=a(2158);let l=(()=>{class n{get profile(){return this._profile.asObservable()}constructor(t,o){this.authService=t,this.apiService=o,this._profile=new O.X(null)}getProfile(){var t=this;return(0,p.Z)(function*(){try{const o=yield t.authService.getId();let r=yield(yield t.apiService.collection("users").doc(o).get().toPromise()).data();console.log("profile: ",r);const c=new S.n(r.email,r.phone,r.name,o,r.type,r.status);return t._profile.next(c),c}catch(o){throw o}})()}updateProfile(t,o){var r=this;return(0,p.Z)(function*(){try{const c=yield r.authService.getId(),C=(yield r.apiService.collection("users").doc(c).update(o),new S.n(o.email,o.phone,t.name,t.uid,t.type,t.status));return r._profile.next(C),C}catch(c){throw console.log(c),c}})()}updateProfileWithEmail(t,o,r){var c=this;return(0,p.Z)(function*(){try{return yield c.authService.updateEmail(t.email,o.email,r),yield c.updateProfile(t,o),t}catch(v){throw v}})()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(m.e),e.LFG(A.s))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var u=a(7020);const h=["phoneInput"];function _(n,s){1&n&&e._UZ(0,"ion-icon",15)}function Z(n,s){1&n&&e._UZ(0,"ion-icon",15)}function y(n,s){if(1&n&&(e.TgZ(0,"ion-button",16),e._uU(1,"UPDATE"),e.qZA()),2&n){e.oxw();const t=e.MAs(6);e.Q6J("disabled",!t.valid)}}function d(n,s){if(1&n&&(e.TgZ(0,"ion-button",17),e._UZ(1,"ion-spinner",18),e.qZA()),2&n){e.oxw();const t=e.MAs(6);e.Q6J("disabled",!t.valid)}}let b=(()=>{class n{constructor(t,o){this.profileService=t,this.global=o,this.isSubmitted=!1}ngOnInit(){setTimeout(()=>{this.phoneInput.setFocus(),console.log("enter")},500)}onSubmit(t){var o=this;return(0,p.Z)(function*(){try{if(!t.valid)return;console.log(t.value),o.isSubmitted=!0,o.profile.email!=t.value.email?o.presentPasswordPrompt(t.value):(yield o.profileService.updateProfile(o.profile,t.value),o.global.modalDismiss()),o.isSubmitted=!1}catch(r){console.log(r),o.isSubmitted=!1,o.global.errorToast()}})()}presentPasswordPrompt(t){this.global.showAlert("Please enter your password to change your Email Address","Verify",[{text:"Cancel",role:"cancel",handler:()=>{console.log("Confirm Cancel")}},{text:"Verify",handler:o=>{console.log(o.password),""!=o.password.trim()&&o.password.length>=8?this.updateEmail(t,o.password):this.global.errorToast("Password must be of at least 8 characters")}}],[{name:"password",type:"password",placeholder:"Enter Password"}])}updateEmail(t,o){var r=this;return(0,p.Z)(function*(){try{yield r.profileService.updateProfileWithEmail(r.profile,t,o),r.global.modalDismiss()}catch(c){console.log(c);let v="No Internet Connection";("auth/email-already-in-use"==c.code||"auth/wrong-password"==c.code)&&(v=c.message),r.global.errorToast(v)}})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(l),e.Y36(u.U))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-edit-profile"]],viewQuery:function(t,o){if(1&t&&e.Gf(h,5),2&t){let r;e.iGM(r=e.CRH())&&(o.phoneInput=r.first)}},inputs:{profile:"profile"},decls:24,vars:6,consts:[[1,"ion-no-border"],["color","dark"],[3,"ngSubmit"],["f","ngForm"],[1,"ion-padding-horizontal","ion-margin-bottom"],[1,"ion-margin-vertical"],["position","floating"],["type","tel","minlength","11","maxlength","11","required","","name","phone",3,"ngModel"],["phoneInput","","phone","ngModel"],["name","checkmark-outline","slot","end","color","primary",4,"ngIf"],["type","email","required","","name","email",3,"ngModel"],["email","ngModel"],[1,"ion-padding-horizontal","ion-text-center"],["expand","block","type","submit","color","primary",3,"disabled",4,"ngIf"],["color","primary",3,"disabled",4,"ngIf"],["name","checkmark-outline","slot","end","color","primary"],["expand","block","type","submit","color","primary",3,"disabled"],["color","primary",3,"disabled"],["name","crescent"]],template:function(t,o){if(1&t){const r=e.EpF();e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title",1),e._uU(3,"EDIT ACCOUNT"),e.qZA()()(),e.TgZ(4,"ion-content")(5,"form",2,3),e.NdJ("ngSubmit",function(){e.CHM(r);const v=e.MAs(6);return e.KtG(o.onSubmit(v))}),e.TgZ(7,"ion-list",4)(8,"ion-item",5)(9,"ion-label",6),e._uU(10,"PHONE NUMBER"),e.qZA(),e._UZ(11,"ion-input",7,8),e.YNc(14,_,1,0,"ion-icon",9),e.qZA(),e.TgZ(15,"ion-item")(16,"ion-label",6),e._uU(17,"EMAIL ADDRESS"),e.qZA(),e._UZ(18,"ion-input",10,11),e.YNc(20,Z,1,0,"ion-icon",9),e.qZA()(),e.TgZ(21,"div",12),e.YNc(22,y,2,1,"ion-button",13),e.YNc(23,d,2,1,"ion-button",14),e.qZA()()()}if(2&t){const r=e.MAs(13),c=e.MAs(19);e.xp6(11),e.Q6J("ngModel",null==o.profile?null:o.profile.phone),e.xp6(3),e.Q6J("ngIf",r.valid),e.xp6(4),e.Q6J("ngModel",null==o.profile?null:o.profile.email),e.xp6(2),e.Q6J("ngIf",c.valid),e.xp6(2),e.Q6J("ngIf",!o.isSubmitted),e.xp6(1),e.Q6J("ngIf",o.isSubmitted)}},dependencies:[g.O5,f._Y,f.JJ,f.JL,f.Q7,f.wO,f.nD,f.On,f.F,i.YG,i.W2,i.Gu,i.gu,i.pK,i.Ie,i.Q$,i.q_,i.PQ,i.wd,i.sr,i.j9],styles:["ion-item[_ngcontent-%COMP%]{align-items:center}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:.8rem!important;font-weight:400!important}"]}),n})();var x=a(1332),M=a(1059),w=a(1479);function U(n,s){if(1&n&&(e.TgZ(0,"ion-text",11)(1,"p"),e._uU(2),e.qZA()()),2&n){const t=s.$implicit;e.xp6(2),e.AsE("",null==t?null:t.name," x ",null==t?null:t.quantity,"")}}let E=(()=>{class n{constructor(){this.reorder=new e.vpe,this.help=new e.vpe}ngOnInit(){}reorderItem(){this.reorder.emit(this.order)}getHelp(){this.help.emit(this.order)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-orders"]],inputs:{order:"order"},outputs:{reorder:"reorder",help:"help"},decls:25,vars:6,consts:[[1,"borderBottom"],["lines","none",1,"dashedBorderBottom"],["name","chevron-forward-outline"],["slot","end","color","dark"],["name","checkmark-circle-outline","color","success"],["lines","none"],["color","dark",4,"ngFor","ngForOf"],[1,"time"],["size","6"],["fill","outline","expand","block","color","primary",3,"click"],["fill","outline","expand","block","color","dark",3,"click"],["color","dark"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-item-group",0)(1,"ion-item",1)(2,"ion-label"),e._uU(3),e.TgZ(4,"p"),e._uU(5),e.qZA(),e.TgZ(6,"ion-text")(7,"p"),e._uU(8),e._UZ(9,"ion-icon",2),e.qZA()()(),e.TgZ(10,"ion-note",3),e._uU(11),e._UZ(12,"ion-icon",4),e.qZA()(),e.TgZ(13,"ion-item",5)(14,"ion-label"),e.YNc(15,U,3,2,"ion-text",6),e.TgZ(16,"p",7),e._uU(17),e.qZA(),e.TgZ(18,"ion-row")(19,"ion-col",8)(20,"ion-button",9),e.NdJ("click",function(){return o.reorderItem()}),e._uU(21,"REORDER"),e.qZA()(),e.TgZ(22,"ion-col",8)(23,"ion-button",10),e.NdJ("click",function(){return o.getHelp()}),e._uU(24,"GET HELP"),e.qZA()()()()()()),2&t&&(e.xp6(3),e.hij(" ",null==o.order||null==o.order.restaurant?null:o.order.restaurant.name," "),e.xp6(2),e.Oqu(null==o.order||null==o.order.restaurant?null:o.order.restaurant.address),e.xp6(3),e.hij(" \u20b9",null==o.order?null:o.order.grandTotal," "),e.xp6(3),e.hij(" ",null==o.order?null:o.order.status," "),e.xp6(4),e.Q6J("ngForOf",null==o.order?null:o.order.order),e.xp6(2),e.Oqu(null==o.order?null:o.order.time))},dependencies:[g.sg,i.YG,i.wI,i.gu,i.Ie,i.Ub,i.Q$,i.uN,i.Nd,i.yW],styles:[".time[_ngcontent-%COMP%]{margin-top:1vh}ion-label[_ngcontent-%COMP%]{font-size:.95rem}ion-label[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:.6rem}ion-note[_ngcontent-%COMP%]{font-size:.87rem}ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{float:right;padding-left:.2rem}p[_ngcontent-%COMP%]{font-size:.8rem}"]}),n})();function J(n,s){1&n&&(e.TgZ(0,"div",6),e._UZ(1,"ion-spinner",0),e.qZA())}function N(n,s){1&n&&(e.TgZ(0,"ion-text",15)(1,"p"),e._uU(2,"No Orders Placed Yet"),e.qZA()())}function Y(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"app-orders",16),e.NdJ("reorder",function(r){e.CHM(t);const c=e.oxw(2);return e.KtG(c.reorder(r))})("help",function(r){e.CHM(t);const c=e.oxw(2);return e.KtG(c.getHelp(r))}),e.qZA()}2&n&&e.Q6J("order",s.$implicit)}const F=function(){return["/","tabs","address"]};function Q(n,s){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"ion-list",7)(2,"ion-item",8)(3,"ion-button",9),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.editProfile())}),e._uU(4,"EDIT"),e.qZA(),e.TgZ(5,"ion-label")(6,"ion-text",10)(7,"h4"),e._uU(8),e.qZA()(),e.TgZ(9,"p"),e._uU(10),e.qZA()()(),e.TgZ(11,"ion-item",11),e._UZ(12,"ion-icon",12),e.TgZ(13,"h5"),e._uU(14,"Manage Addresses"),e.qZA()()(),e.TgZ(15,"ion-list")(16,"ion-list-header")(17,"ion-label",0),e._uU(18,"PAST ORDERS"),e.qZA()(),e.YNc(19,N,3,0,"ion-text",13),e.YNc(20,Y,1,1,"app-orders",14),e.qZA(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(8),e.Oqu(null==t.profile?null:t.profile.name),e.xp6(2),e.AsE("",null==t.profile?null:t.profile.phone," | ",null==t.profile?null:t.profile.email,""),e.xp6(1),e.Q6J("routerLink",e.DdM(6,F)),e.xp6(8),e.Q6J("ngIf",!t.orders||0==(null==t.orders?null:t.orders.length)),e.xp6(1),e.Q6J("ngForOf",t.orders)}}const L=[{path:"",component:(()=>{class n{constructor(t,o,r,c,v,C){this.navCtrl=t,this.orderService=o,this.cartService=r,this.global=c,this.profileService=v,this.authService=C,this.profile={},this.orders=[]}ngOnInit(){this.ordersSub=this.orderService.orders.subscribe(t=>{console.log("order data: ",t),this.orders=t},t=>{console.log(t)}),this.profileSub=this.profileService.profile.subscribe(t=>{this.profile=t,console.log(this.profile)}),this.getData()}ionViewDidEnter(){console.log("ionViewDidEnter AccountPage"),this.global.customStatusbar(!0)}getData(){var t=this;return(0,p.Z)(function*(){t.isLoading=!0,yield t.profileService.getProfile(),yield t.orderService.getOrders(),t.isLoading=!1})()}confirmLogout(){this.global.showAlert("Are you sure you want to sign-out?","Confirm",[{text:"No",role:"cancel"},{text:"Yes",handler:()=>{this.logout()}}])}logout(){this.global.showLoader(),this.authService.logout().then(()=>{this.navCtrl.navigateRoot(x.e.LOGIN),this.global.hideLoader()}).catch(t=>{console.log(t),this.global.hideLoader(),this.global.errorToast("Logout Failed! Check your internet connection")})}reorder(t){var o=this;return(0,p.Z)(function*(){console.log(t);let r=yield o.cartService.getCart();console.log("data: ",r),r?.value?o.cartService.alertClearCart(null,null,null,t):o.cartService.orderToCart(t)})()}getHelp(t){console.log(t)}editProfile(){var t=this;return(0,p.Z)(function*(){const o={component:b,componentProps:{profile:t.profile},cssClass:"custom-modal",swipeToClose:!0};yield t.global.createModal(o)})()}ionViewDidLeave(){console.log("ionViewDidLeave AccountPage"),this.global.customStatusbar()}ngOnDestroy(){this.ordersSub&&this.ordersSub.unsubscribe(),this.profileSub&&this.profileSub.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(i.SH),e.Y36(M.p),e.Y36(w.N),e.Y36(u.U),e.Y36(l),e.Y36(m.e))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-account"]],decls:10,vars:2,consts:[["color","primary"],["slot","end"],["fill","clear",3,"click"],["name","power-outline","color","white","slot","icon-only"],["class","ion-text-center alignSpinner",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","alignSpinner"],[1,"borderBottom"],["lines","full"],["slot","end","fill","clear",3,"click"],[1,"ion-text-uppercase"],["lines","none","detail","true",3,"routerLink"],["name","home-outline","slot","start","color","dark"],["class","ion-text-center",4,"ngIf"],[3,"order","reorder","help",4,"ngFor","ngForOf"],[1,"ion-text-center"],[3,"order","reorder","help"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e._uU(3,"My Account"),e.qZA(),e.TgZ(4,"ion-buttons",1)(5,"ion-button",2),e.NdJ("click",function(){return o.confirmLogout()}),e._UZ(6,"ion-icon",3),e.qZA()()()(),e.TgZ(7,"ion-content"),e.YNc(8,J,2,0,"div",4),e.YNc(9,Q,21,7,"ng-container",5),e.qZA()),2&t&&(e.xp6(8),e.Q6J("ngIf",o.isLoading),e.xp6(1),e.Q6J("ngIf",!o.isLoading))},dependencies:[g.sg,g.O5,i.YG,i.Sm,i.W2,i.Gu,i.gu,i.Ie,i.Q$,i.q_,i.yh,i.PQ,i.yW,i.wd,i.sr,i.YI,P.rH,E],styles:["p[_ngcontent-%COMP%]{font-size:.8rem}"]}),n})()}];let G=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[P.Bz.forChild(L),P.Bz]}),n})(),k=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[g.ez,f.u5,i.Pc,G]}),n})()},1059:(I,T,a)=>{a.d(T,{p:()=>S});var g=a(5861),f=a(1135),i=a(3900);class P{constructor(A,l,u,h,_,Z,y,d,b,x,M,w,U){this.address=A,this.restaurant=l,this.restaurant_id=u,this.order=h,this.total=_,this.grandTotal=Z,this.deliveryCharge=y,this.status=d,this.time=b,this.paid=x,this.id=M,this.uid=w,this.instruction=U}}var p=a(2223),e=a(1228),O=a(2158);let S=(()=>{class m{get orders(){return this._orders.asObservable()}constructor(l,u){this.auth=l,this.api=u,this._orders=new f.X([])}getRadius(){return this.api.radius}getUid(){var l=this;return(0,g.Z)(function*(){return l.uid?l.uid:yield l.auth.getId()})()}getOrderRef(){var l=this;return(0,g.Z)(function*(){return l.uid=yield l.getUid(),l.api.collection("orders").doc(l.uid).collection("all")})()}getOrders(){var l=this;return(0,g.Z)(function*(){try{const u=yield(yield l.getOrderRef()).get().pipe((0,i.w)(function(){var h=(0,g.Z)(function*(_){let Z=yield _.docs.map(y=>{let d=y.data();return d.id=y.id,d.order=JSON.parse(d.order),d.restaurant.get().then(b=>{d.restaurant=b.data()}).catch(b=>{throw b}),d});return console.log(Z),Z});return function(_){return h.apply(this,arguments)}}())).toPromise();return console.log("orders",u),l._orders.next(u),u}catch(u){throw u}})()}placeOrder(l){var u=this;return(0,g.Z)(function*(){try{let h={...l};h.order=JSON.stringify(l.order);const _=yield u.getUid();h.restaurant=yield u.api.firestore.collection("restaurants").doc(l.restaurant_id);const y=yield(yield(yield u.getOrderRef()).add(h)).id;console.log("latest order: ",l);let d=[];return d.push(new P(l.address,l.restaurant,l.restaurant_id,l.order,l.total,l.grandTotal,l.deliveryCharge,l.status,l.time,l.paid,y,_,l.instruction)),console.log("latest order: ",d),d=d.concat(u._orders.value),console.log("orders: ",d),u._orders.next(d),d}catch(h){throw h}})()}}return m.\u0275fac=function(l){return new(l||m)(p.LFG(e.e),p.LFG(O.s))},m.\u0275prov=p.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()}}]);